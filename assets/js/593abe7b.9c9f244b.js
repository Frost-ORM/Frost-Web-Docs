"use strict";(self.webpackChunkfrost_web_doc=self.webpackChunkfrost_web_doc||[]).push([[326],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),l=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=l(a),m=r,h=c["".concat(p,".").concat(m)]||c[m]||u[m]||i;return a?n.createElement(h,o(o({ref:t},d),{},{components:a})):n.createElement(h,o({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<i;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},8248:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:5},o="Multiple Location Write",s={unversionedId:"docs/operations/multiple-location-write",id:"version-1.0.3/docs/operations/multiple-location-write",title:"Multiple Location Write",description:"- For Every function in FrostApi that modifies the database (add, update, delete) we have an equivalent getMap function.",source:"@site/versioned_docs/version-1.0.3/docs/operations/multiple-location-write.md",sourceDirName:"docs/operations",slug:"/docs/operations/multiple-location-write",permalink:"/frost-web-docs/1.0.3/docs/operations/multiple-location-write",draft:!1,tags:[],version:"1.0.3",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Delete",permalink:"/frost-web-docs/1.0.3/docs/operations/delete"},next:{title:"Extra",permalink:"/frost-web-docs/1.0.3/category/extra"}},p={},l=[{value:"Limitations",id:"limitations",level:2}],d={toc:l};function u(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"multiple-location-write"},"Multiple Location Write"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For Every function in ",(0,r.kt)("a",{parentName:"li",href:"../../api/classes/FrostApi"},"FrostApi")," that modifies the database (",(0,r.kt)("a",{parentName:"li",href:"../../api/classes/FrostApi#add"},"add"),", ",(0,r.kt)("a",{parentName:"li",href:"../../api/classes/FrostApi#update"},"update"),", ",(0,r.kt)("a",{parentName:"li",href:"../../api/classes/FrostApi#delete"},"delete"),") we have an equivalent ",(0,r.kt)("inlineCode",{parentName:"li"},"getMap")," function."),(0,r.kt)("li",{parentName:"ul"},"The equivalent ",(0,r.kt)("inlineCode",{parentName:"li"},"getMap")," function returns an extra property (",(0,r.kt)("inlineCode",{parentName:"li"},"map"),") to the returned map from it's equivalent operation function (ie; ",(0,r.kt)("inlineCode",{parentName:"li"},"add")," returns ",(0,r.kt)("inlineCode",{parentName:"li"},"{ id }")," ,",(0,r.kt)("inlineCode",{parentName:"li"},"getAddMap")," returns ",(0,r.kt)("inlineCode",{parentName:"li"},"{ id, map }"),"). This map contains the update map that should be passed to the firebase ",(0,r.kt)("a",{parentName:"li",href:"https://firebase.google.com/docs/reference/js/database#update"},"update")," function."),(0,r.kt)("li",{parentName:"ul"},"This allows us to utilize the ",(0,r.kt)("a",{parentName:"li",href:"https://firebase.blog/posts/2015/09/introducing-multi-location-updates-and_86"},"multiple location writes")," feature in the firebaseDB."),(0,r.kt)("li",{parentName:"ul"},"All you have to do is preform multiple operations and join the all of the maps and pass the joined map to the firebaseDB ",(0,r.kt)("a",{parentName:"li",href:"https://firebase.google.com/docs/reference/js/database#update"},"update")," function")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Immediate operation"),(0,r.kt)("th",{parentName:"tr",align:null},"Equivalent ",(0,r.kt)("inlineCode",{parentName:"th"},"getMap")," function"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"../../api/classes/FrostApi#add"},"add")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"../../api/classes/FrostApi#getAddMap"},"getAddMap"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"../../api/classes/FrostApi#update"},"update")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"../../api/classes/FrostApi#getUpdateMap"},"getUpdateMap"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"../../api/classes/FrostApi#delete"},"delete")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"../../api/classes/FrostApi#getDeleteMap"},"getDeleteMap"))))),(0,r.kt)("h2",{id:"limitations"},"Limitations"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Firebase has a small limitation in Multi-Location writes, you can't have an update to a node and another separate update to a child of that node (ie; two updates to the same location with different paths).")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"In the example below:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Lines 8-21"),": These lines will throw an error because the final update map will have the path to set the ",(0,r.kt)("inlineCode",{parentName:"li"},"user")," node, And each ",(0,r.kt)("inlineCode",{parentName:"li"},"post")," add will also result in a update path inside that same user node (in order to connect them by setting ID values in the user node.)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Lines 24-36"),": To overcome the problem in the first example, we can preform the adding of the user (either by passing the ",(0,r.kt)("inlineCode",{parentName:"li"},"UserAddMap")," to the update function or by replacing the ",(0,r.kt)("inlineCode",{parentName:"li"},"getAddMap")," wit ",(0,r.kt)("inlineCode",{parentName:"li"},"add"),"). After That you can preform the adding of multiple posts. This way the final map won't have the path to the user node, So all the update paths from the posts connection to the user won't interfere with it.")))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"In later versions, Frost will provide utilities to resolve the conflicts in the firebase update map.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=src/index.ts showLineNumbers",title:"src/index.ts",showLineNumbers:!0},"import { User } from \"src/data/user\"\nimport { Post } from \"src/data/Post\"\nimport { FrostApp } from \"src/data/frost\"\nimport { update } from \"firebase/database\";\n\nconst user = new User({...})\n\n//highlight-error-start\nconst { id: userId, map: addUserMap } = (await FrostApp.users.getAddMap(user))\n\n\nconst post_1 = new Post({...})\nconst post_2 = new Post({...})\n\nconst {id:postId_1, map: addPostMap_1} = await FrostApp.posts.getAddMap(post_1,{'user':userId})\nconst {id:postId_2, map: addPostMap_2} = await FrostApp.posts.getAddMap(post_2,{'user':userId})\n\nawait update({\n  ...addUserMap,\n  ...addPostMap_1,\n  ...addPostMap_2,\n})\n//highlight-error-end\n\n//This the correct way to do it\n//highlight-correct-start\nconst { id: userId } = (await FrostApp.users.add(user))\n\n\nconst post_1 = new Post({...})\nconst post_2 = new Post({...})\n\nconst {id:postId_1, map: addPostMap_1} = await FrostApp.posts.getAddMap(post_1,{'user':userId})\nconst {id:postId_2, map: addPostMap_2} = await FrostApp.posts.getAddMap(post_2,{'user':userId})\n\nawait update({\n  ...addPostMap_1,\n  ...addPostMap_2,\n})\n//highlight-correct-end\n\n")))}u.isMDXComponent=!0}}]);